"undefined"==typeof SAFARI&&!function(){if(SAFARI="undefined"!=typeof safari,LEGACY_SAFARI=SAFARI&&(navigator.appVersion.match(/\sSafari\/(\d+)\./)||[null,0])[1]<534,options=SAFARI?safari.extension.settings:localStorage,SAFARI){var e,a=!!safari.extension.bars,n=function(){return safari.self&&safari.self.addEventListener?safari.self:safari.application&&safari.application.addEventListener?safari.application:(console.log("No add/remove event listener possible at this location!"),console.trace(),{addEventListener:function(){},removeEventListener:function(){}})},t=function(e,a){var t=function(n){n.name==e&&a(n)};return n().addEventListener("message",t,!1),t},i=function(e){n().removeEventListener("message",e,!1)},o=function(e){var a=e;if(a&&a.target&&a.target.page&&a.target.page.dispatchMessage)return a.target.page;var n=safari.self;if(n&&n.tab&&n.tab.dispatchMessage)return n.tab;var t=safari.application&&safari.application.activeBrowserWindow,i=t&&t.activeTab&&t.activeTab.page;return i&&i.dispatchMessage?i:(console.log("No dispatchMessage possible at this location!"),console.trace(),{dispatchMessage:function(){}})},r=function(){var e=[],a=0,n=function(n){return e=e.filter(function(e){return null!=e.browserWindow}),void 0==n.id&&(n.id=a+1,a=n.id,e.push(n)),n.id};return n}();chrome={extension:{getBackgroundPage:function(){return safari.extension.globalPage.contentWindow},getURL:function(e){return safari.extension.baseURI+e},getViews:function(e){for(var a=safari.extension.bars.concat(safari.extension.menus,safari.extension.popovers,safari.extension.toolbarItems),n=a.length,t=0;n>t;t++){var i=a[t];if(i.identifier==e.type)return[i.contentWindow]}},sendRequest:function(){function e(e,a){var o="callback"+Math.random();n.forEach(function(a){var n={data:e,callbackToken:o};a.dispatchMessage("request",n)});var r=t("response",function(e){e.message.callbackToken==o&&(window.setTimeout(function(){i(r)},0),a&&a(e.message.data))})}var n=[];return a?t("onRequest registration",function(e){var a=o(e);-1==n.indexOf(a)&&n.push(a)}):n.push(o()),e}(),onRequest:{addListener:function(e){a||o().dispatchMessage("onRequest registration",{}),t("request",function(n){var t=n.message.data,i={};if(a){var s=r(n.target);i.tab={id:s,url:n.target.url}}var c=function(e){var a={callbackToken:n.message.callbackToken,data:e};o(n).dispatchMessage("response",a)};e(t,i,c)})}},connect:function(e){var a="portUuid"+Math.random(),n={name:e.name,uuid:a};o().dispatchMessage("port-create",n);var i={name:e.name,onMessage:{addListener:function(e){t("port-postMessage",function(n){n.message.portUuid==a&&e(n.message.data)})}}};return i},onConnect:{addListener:function(e){t("port-create",function(a){var n=a.message.name,t=a.message.uuid,i=r(a.target),s={name:n,sender:{tab:{id:i,url:a.target.url}},onDisconnect:{addListener:function(){}},postMessage:function(e){o(a).dispatchMessage("port-postMessage",{portUuid:t,data:e})}};e(s)})}},onRequestExternal:{addListener:function(){}}},cookies:{getAll:function(){},getAllCookieStores:function(){},onChanged:{addListener:function(){}},remove:function(){},set:function(){}},tabs:{create:function(e,a){var n=safari.application.activeBrowserWindow.openTab(e.visibility||"foreground",e.index||safari.application.activeBrowserWindow.tabs.length);n.url=e.url,a&&a(n)},onUpdated:{addListener:function(e){safari.application.addEventListener("beforeNavigate",function(a){e(a.target.id,{status:"loading",url:a.target.url,pinned:null},{id:a.target.id,index:null,windowId:null,openerTabId:null,highlighted:null,active:a.target.id==a.target.browserWindow.activeTab.id,pinned:null,url:a.target.url,title:a.target.title,favIconUrl:null,status:"loading",incognito:null})},!0)}},query:function(e,a){if(e.active){var n=safari.application.activeBrowserWindow.activeTab;n.id=r(n),a([n])}else{for(var t=[],i=safari.application.browserWindows,o=i.length,s=0;o>s;s++)for(var c=i[s].tabs,l=c.length,u=0;l>u;u++){var n=c[u];n.id=r(n),t.push(n)}a(t)}},reload:function(e){var a=safari.application.browserWindows,n=a.length;e:for(var t=0;n>t;t++)for(var i=a[t].tabs,o=i.length,s=0;o>s;s++){var c=i[s];if(r(c)==e){c.url=c.url;break e}}}},browserAction:{getPopup:function(e,a){a(safari.extension.toolbarItems[0].popover.contentWindow.location.href)},onClicked:{addListener:function(e){safari.application.addEventListener("popover",e,!0)}},setBadgeBackgroundColor:function(){},setBadgeText:function(e){var a=e.tabId;a&&a!=r(safari.application.activeBrowserWindow.activeTab)||(safari.extension.toolbarItems[0].badge=e.text),e.handled||safari.application.addEventListener("activate",function(){e.handled=!0,chrome.browserAction.setBadgeText(e)},!0)},setIcon:function(e){for(var a=safari.extension.toolbarItems,n=a.length,t=chrome.extension.getURL(e.path),i=0;n>i;i++)a[i].image=t;e.handled||safari.application.addEventListener("open",function(){e.handled=!0,chrome.browserAction.setIcon(e)},!0)},setPopup:function(a){var n=safari.extension.toolbarItems,t=n.length;e||(e=safari.extension.createPopover("popup",chrome.extension.getURL(a.popup),a.width||400,a.height||300));for(var i=0;t>i;i++){var o=n[i];o.popover=e,o.command=null}a.handled||safari.application.addEventListener("open",function(){a.handled=!0,chrome.browserAction.setPopup(a)},!0)}},webRequest:{onBeforeRequest:{addListener:function(){}}},webNavigation:{onCommitted:{addListener:function(){}}},i18n:function(){function e(e,a){var n=new XMLHttpRequest;n.open("GET",chrome.extension.getURL(e),!1),n.onreadystatechange=function(){4==this.readyState&&""!=this.responseText&&a(this.responseText)};try{n.send()}catch(t){}}function a(e,a){function n(e,a,n){var t=/\$\$/g,i="~~~I18N~~:";e=e.replace(t,i),e=e.replace(a,n);var o=/~~~I18N~~:/g,r="$$$$";return e=e.replace(o,r)}if(void 0==e.placeholders&&void 0==a)return e.message.replace(/\$\$/g,"$");var t=/\$([1-9])/g,i=function(e,n){return a[n-1]},o={};for(var r in e.placeholders){var s=e.placeholders[r].content;o[r.toLowerCase()]=n(s,t,i)}var c=n(e.message,t,i);return c=n(c,/\$(\w+?)\$/g,function(e,a){var n=a.toLowerCase();return n in o?o[n]:e}),c=c.replace(/\$\$/g,"$")}var n=void 0,t={_getL10nData:function(){var a={locales:[]};a.locales.push(navigator.language.replace("-","_")),navigator.language.length>2&&a.locales.push(navigator.language.substring(0,2)),-1==a.locales.indexOf("en")&&a.locales.push("en"),a.messages={};for(var n=0;n<a.locales.length;n++){var t=a.locales[n],i="_locales/"+t+"/messages.json";e(i,function(e){a.messages[t]=JSON.parse(e)})}return a},_setL10nData:function(e){n=e},getMessage:function(e,t){void 0==n&&chrome.i18n._setL10nData(chrome.i18n._getL10nData()),"string"==typeof t&&(t=[t]);for(var i=0;i<n.locales.length;i++){var o=n.messages[n.locales[i]];if(o&&e in o)return a(o[e],t)}return""}};return t}()}}}();